name: 同步文件到多个仓库

on:
  # 当推送到 main 分支时自动触发
  push:
    branches:
      - main
    # 可以指定只监听特定路径的变更
    paths:
      - 'LICENSE'
      # 根据需要添加更多路径
  
  # 支持手动触发
  workflow_dispatch:

jobs:
  sync-files:
    name: 同步文件
    runs-on: ubuntu-latest
    
    steps:
      # 检出当前仓库
      - name: Checkout 源仓库
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # 同步文件到其他仓库
      - name: 同步文件到多个仓库
        uses: derberg/manage-files-in-multiple-repositories@v2
        with:
          # GitHub Token (必须使用 Classic PAT,不能使用 fine-grained token)
          # 必需权限: repo, workflow, read:org
          # 在仓库设置 -> Secrets and variables -> Actions 中添加
          github_token: ${{ secrets.REPO_SYNC_TOKEN }}
          
          # 要同步的文件或目录路径(用逗号分隔)
          # 支持具体文件和目录
          patterns_to_include: 'LICENSE'
          
          # 要忽略的文件(可选)
          # 例如:忽略当前这个同步workflow文件本身
          patterns_to_ignore: '.github/workflows/sync-files.yml'
          
          # 要忽略的仓库列表(可选,用逗号分隔)
          # 示例: repos_to_ignore: 'your-username/repo-to-ignore,your-username/another-repo'
          
          # 根据 GitHub Topics 选择要同步的仓库(推荐使用此方式精确控制)
          # 只同步到包含这些 topics 的仓库
          topics_to_include: 'sync-enabled,template'
          
          # 排除私有仓库(可选,默认 false)
          exclude_private: true
          
          # 排除 fork 的仓库(可选,默认 false)
          exclude_forked: true
          
          # 目标分支匹配模式(可选)
          # 支持正则表达式,多个用逗号分隔
          # 示例: branches: 'main,master,develop'
          
          # 提交者用户名
          committer_username: 'github-actions[bot]'
          
          # 提交者邮箱
          committer_email: 'github-actions[bot]@users.noreply.github.com'
          
          # 提交信息
          commit_message: 'chore: 从模板仓库同步文件'
          
          # PR分支名称(可选,用于标识同步PR)
          bot_branch_name: 'repo-sync/template-update'